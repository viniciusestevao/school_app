<% content_for :title, "Cursos" %>

<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h3 m-0">Cursos</h1>
  <% if current_user.admin? %>
    <%= link_to "Novo curso", new_course_path, class: "btn btn-primary" %>
  <% end %>
</div>

<% if @courses.any? %>
  <div class="card">
    <div class="table-responsive">
      <table class="table table-hover align-middle m-0">
        <thead class="table-light">
          <tr>
            <th><%= sort_link('title', 'Título') %></th>
            <th><%= sort_link('description', 'Descrição') %></th>
            <th class="text-nowrap"><%= sort_link('created_at', 'Criado em') %></th>
            <th class="text-end">Ações</th>
          </tr>
        </thead>
        <tbody>
          <% @courses.each do |course| %>
            <tr id="<%= dom_id(course) %>">
              <td><%= course.title %></td>
              <td class="text-muted"><%= truncate(course.description.to_s, length: 120) %></td>
              <td class="text-muted text-nowrap"><%= l(course.created_at, format: :short) %></td>
              <td class="text-end">
                <%= link_to "Ver",    course_path(course, page: params[:page], sort: params[:sort], dir: params[:dir], items: params[:items]), class: "btn btn-sm btn-outline-secondary me-1" %>
                <% if current_user.admin? %>
                  <%= link_to "Editar", edit_course_path(course), class: "btn btn-sm btn-outline-primary me-1" %>
                  <%= link_to "Excluir", course,
                        data: { turbo_method: :delete,
                                turbo_confirm: "Tem certeza que deseja excluir o curso “#{course.title}”?" },
                        class: "btn btn-sm btn-outline-danger" %>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <!-- Footer de paginação -->
    <div class="card-footer d-flex flex-column flex-md-row justify-content-between align-items-center">
      <div class="mb-2 mb-md-0 small text-muted">
        <%== pagy_info(@pagy) %>
      </div>
      <div class="d-flex align-items-center gap-2">
        <%== pagy_bootstrap_nav(@pagy) if @pagy.pages > 1 %>
      </div>
    </div>
  </div>
<% else %>
  <div class="text-center p-5 border rounded-3 bg-light">
    <p class="mb-3">Nenhum curso cadastrado ainda.</p>
    <%= link_to "Cadastrar primeiro curso", new_course_path, class: "btn btn-primary" %>
  </div>
<% end %>